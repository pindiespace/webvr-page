(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var BarrelDistortion=require("./distortion/barrel-distortion-fragment-v2.js");function ShaderPass(shader){this.uniforms=THREE.UniformsUtils.clone(shader.uniforms);this.material=new THREE.ShaderMaterial({defines:shader.defines||{},uniforms:this.uniforms,vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader});this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);this.scene=new THREE.Scene;this.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null);this.scene.add(this.quad)}ShaderPass.prototype.render=function(renderFunc,buffer){this.uniforms.texture.value=buffer;this.quad.material=this.material;renderFunc(this.scene,this.camera)};function createRenderTarget(renderer){var width=renderer.context.canvas.width;var height=renderer.context.canvas.height;var parameters={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:false};return new THREE.WebGLRenderTarget(width,height,parameters)}function CardboardDistorter(renderer,deviceInfo){this.shaderPass=new ShaderPass(BarrelDistortion);this.renderer=renderer;this.textureTarget=null;this.genuineRender=renderer.render;this.genuineSetSize=renderer.setSize;this.isActive=false;this.deviceInfo=deviceInfo}CardboardDistorter.prototype.patch=function(camera){if(!this.isActive){return}this.oldFOV=camera.fov;this.newAspect=screen.width/screen.height/2;this.newFOV=this.oldFOV*(2+this.newAspect)/2;this.textureTarget=createRenderTarget(this.renderer);this.renderer.render=function(scene,camera,renderTarget,forceClear){camera.aspect=this.newAspect;camera.fov=this.newFOV;camera.updateProjectionMatrix();this.genuineRender.call(this.renderer,scene,camera,this.textureTarget,forceClear)}.bind(this);this.renderer.setSize=function(width,height){this.genuineSetSize.call(this.renderer,width,height);this.textureTarget=createRenderTarget(this.renderer)}.bind(this)};CardboardDistorter.prototype.unpatch=function(){if(!this.isActive){return}this.renderer.render=this.genuineRender;this.renderer.setSize=this.genuineSetSize};CardboardDistorter.prototype.preRender=function(){if(!this.isActive){return}this.renderer.setRenderTarget(this.textureTarget)};CardboardDistorter.prototype.postRender=function(){if(!this.isActive){return}var size=this.renderer.getSize();this.renderer.setViewport(0,0,size.width,size.height);this.shaderPass.render(this.genuineRender.bind(this.renderer),this.textureTarget)};CardboardDistorter.prototype.setActive=function(state){this.isActive=state};CardboardDistorter.prototype.recalculateUniforms=function(){var uniforms=this.shaderPass.material.uniforms;var distortedProj=this.deviceInfo.getProjectionMatrixLeftEye();var undistortedProj=this.deviceInfo.getProjectionMatrixLeftEye(true);var viewport=this.deviceInfo.getUndistortedViewportLeftEye();var device=this.deviceInfo.device;var params={xScale:viewport.width/(device.width/2),yScale:viewport.height/device.height,xTrans:2*(viewport.x+viewport.width/2)/(device.width/2)-1,yTrans:2*(viewport.y+viewport.height/2)/device.height-1};uniforms.projectionLeft.value.copy(this.projectionMatrixToVector_(distortedProj));uniforms.unprojectionLeft.value.copy(this.projectionMatrixToVector_(undistortedProj,params));var coefficients=this.deviceInfo.viewer.distortionCoefficients;uniforms.distortion.value.set(coefficients[0],coefficients[1]);if(WebVRConfig.SHOW_EYE_CENTERS){uniforms.showCenter.value=1}if(WebVRConfig.DISTORTION_BGCOLOR){uniforms.backgroundColor.value=WebVRConfig.DISTORTION_BGCOLOR}this.shaderPass.material.needsUpdate=true};CardboardDistorter.prototype.setDistortionCoefficients=function(coefficients){var value=new THREE.Vector2(coefficients[0],coefficients[1]);this.shaderPass.material.uniforms.distortion.value=value;this.shaderPass.material.needsUpdate=true};CardboardDistorter.prototype.projectionMatrixToVector_=function(matrix,opt_params){var params=opt_params||{};var xScale=params.xScale||1;var yScale=params.yScale||1;var xTrans=params.xTrans||0;var yTrans=params.yTrans||0;var elements=matrix.elements;var vec=new THREE.Vector4;vec.set(elements[4*0+0]*xScale,elements[4*1+1]*yScale,elements[4*2+0]-1-xTrans,elements[4*2+1]-1-yTrans).divideScalar(2);return vec};module.exports=CardboardDistorter},{"./distortion/barrel-distortion-fragment-v2.js":4}],2:[function(require,module,exports){var Util=require("./util.js");var Distortion=require("./distortion/distortion.js");var ViewerInfo=require("./viewer-info.js");var DeviceList=require("./device/device-list.js");function DeviceInfo(params){var DEFAULT_LEFT_CENTER={x:.5,y:.5};var DEFAULT_RIGHT_CENTER={x:.5,y:.5};this.detected=false;this.tests={};if(params){this.viewerInfo=new ViewerInfo(params)}else{this.viewerInfo=new ViewerInfo}this.viewer=this.getViewer();this.device=null;this.ua=(navigator.userAgent||navigator.vendor||window.opera).toLowerCase();this.devList=new DeviceList;if(params.deviceName){this.setDevice(deviceName)}else{this.detectGL_();this.detectDisplay_();this.detectOS_();this.detectFormFactor_();this.getDevice()}}DeviceInfo.prototype.getDevice=function(){if(!this.device){return this.detectDevice()}return this.device};DeviceInfo.prototype.getViewer=function(){if(!this.viewer){return this.viewerInfo.getViewer()}return this.viewer};DeviceInfo.prototype.setDevice=function(deviceName){var list=this.devList.getList(deviceList);var dev=list[deviceName];if(dev){if(dev!=this.device){this.detected=false}this.device=dev;return this.device}console.error("device "+deviceName+" not found in deviceList");return{}};DeviceInfo.prototype.getDeviceNames=function(deviceList){var names=[];var list=this.devList.getList(deviceList);for(var i in list){names.push(i)}list=null;return names};DeviceInfo.prototype.getDeviceLabels=function(deviceList){var labels=[];if(!deviceList){deviceList=this.deviceGroup_ALL}var list=this.devList.getList(deviceList);for(var i in list){labels.push(list[i].label)}list=null;return labels};DeviceInfo.prototype.getDeviceByName=function(deviceName){var list=this.deviceList.getList(this.deviceList.DEVICE_ALL);var dev=list[deviceName];if(dev){return dev}console.error("Device "+deviceName+" not found in lists");return{}};DeviceInfo.prototype.searchDevice=function(keywords){};DeviceInfo.prototype.detectDevice=function(){var ua=this.ua;var devices={};this.deviceGroup={iphone:ua.indexOf("iphone")>=0,ipad:ua.indexOf("ipad")>=0,ipod:ua.indexOf("ipod")>=0,windowsphone:ua.indexOf("windows phone")>=0};this.deviceGroup.android=!this.deviceGroup.windowsphone&&ua.indexOf("android")>=0;if(this.deviceGroup.android){devices=this.devList.getList(this.devList.DEVICE_ANDROID)}else if(this.deviceGroup.iphone){devices=this.devList.getList(this.devList.DEVICE_IPHONE)}else if(this.deviceGroup.ipad){this.tests.devicemotion=this.detectEvents_(window,"devicemotion");devices=this.devList.getList(this.devList.DEVICE_IPAD)}else if(this.deviceGroup.ipod){devices=this.devList.getList(this.devList.DEVICE_IPOD)}else if(this.deviceGroup.windowsphone){devices=this.devList.getList(this.devList.DEVICE_WINDOWS_PHONE)}else if(this.deviceGroup.blackberry){devices=this.devList.getList(this.devList.DEVICE_BLACKBERRY)}else if(this.os.tizen){devices=this.devList.getList(this.devList.DEVICE_TIZEN)}else if(this.os.windows){}else if(this.os.mac){}else{}for(var i in devices){if(devices[i].detect(this.ua,this.display,this.tests)){this.device=devices[i];console.log("device found:"+this.device.label+".");return true}}console.warn("using generic device");this.device=this.devList.getDefault(this.display);if(this.desktop==true){this.detected=true}return this.device};DeviceInfo.prototype.detectGL_=function(){var cs,ctx,canvas,webGL,glVersion,glVendor,glShaderVersion;this.tests.canvas=!!window.CanvasRenderingContext2D;if(this.tests.canvas){this.tests.webGL=false;cs=document.createElement("canvas");var names=["webgl","webgl2","experimental-webgl","experimental-webgl2","moz-webgl","3d","webkit-3d"];for(i in names){try{ctx=cs.getContext(names[i]);if(ctx&&ctx instanceof"WebGLRenderingContext"){this.tests.webGL=true;this.tests.webGLCtxName=names[i]}}catch(e){}}}if(ctx){this.tests.glVersion=ctx.getParameter(ctx.VERSION).toLowerCase();this.tests.glVendor=ctx.getParameter(ctx.VENDOR).toLowerCase();this.tests.glShaderVersion=ctx.getParameter(ctx.SHADING_LANGUAGE_VERSION).toLowerCase();this.tests.glRenderer=ctx.getParameter(ctx.RENDERER).toLowerCase()}cs=ctx=undefined};DeviceInfo.prototype.detectDisplay_=function(){this.display={touch:!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch),pixelRatio:window.devicePixelRatio||(window.matchMedia&&window.matchMedia("(min-resolution: 2dppx), (-webkit-min-device-pixel-ratio: 1.5),(-moz-min-device-pixel-ratio: 1.5),(min-device-pixel-ratio: 1.5)").matches?2:1)||1,screenWidth:Math.max(window.screen.width,window.screen.height)||0,screenHeight:Math.min(window.screen.width,window.screen.height)||0};this.display.pixelWidth=this.display.screenWidth*this.display.pixelRatio;this.display.pixelHeight=this.display.screenHeight*this.display.pixelRatio;this.display.retina=this.display.pixelRatio>1;var long=Math.max(this.display.screenWidth,this.display.screenHeight);var short=Math.min(this.display.screenWidth,this.display.screenHeight);this.display.longest=Math.max(long,short)};DeviceInfo.prototype.detectEvents_=function(elem,eventName){eventName="on"+eventName;var isSupported=eventName in elem;if(!isSupported){el.setAttribute(eventName,"return;");isSupported=typeof elem[eventName]=="function"}return isSupported};DeviceInfo.prototype.detectOS_=function(){var m;var ua=this.ua;this.os={ios:/(iphone|ipad|ipod)/.test(ua),crios:/(cros|crmo)/.test(ua),linux:ua.indexOf("linux")>=0,windowsphone:ua.indexOf("windows phone")>=0,blackberry:/(blackberry|bb10|rim[0-9])/.test(ua),tizen:ua.indexOf("tizen")>=0,firefoxos:/mobile.*(firefox)/i.test(ua)};this.os.android=!this.os.windowsphone&&ua.indexOf("android")>=0;this.os.mac=!this.os.ios&&ua.indexOf("mac os x")>=0;this.os.windows=!this.os.windowsphone&&ua.indexOf("windows")>=0;if(this.os.ios){m=ua.match(/os (\d+)_(\d+)_?(\d+)?/);if(m&&m[1]&&m[2]){this.os.version=parseFloat(m[1]+"."+m[2])}}else if(this.os.crios){}else if(this.os.linux){}else if(this.os.android){m=ua.match(/android (\d+(?:\.\d+)+)[;)]/);if(m&&m[0]){this.os.version=parseFloat(m[0])}}else if(this.os.windowsphone){m=ua.match(/windows phone (\d+\.\d+)/);if(m&&m[1]){this.os.version=parseFloat(m[1])}}else if(this.os.blackberry){if(ua.indexOf("bb10")>=0){m=ua.match(/bb10.*version\/(\d+\.\d+)?/);if(m&&m[0]){this.os.version=parseFloat(m[1])}}}else if(this.os.tizen){m=ua.match(/tizen.*(\d+\.\d+)/)}else if(this.os.windows){}else if(this.os.mac){}else{this.os.version=0}};DeviceInfo.prototype.detectFormFactor_=function(){var ua=this.ua;this.mobile=this.os.ios||this.os.android||/mobi|ip(hone|od|ad)|touch|blackberry|bb10|windows phone|kindle|silk|htc|(hpw|web)os|opera mini|fxios/.test(ua);this.tablet=/ipad|tablet|nexus[\s]+(7|9|10)|playbook|silk|ideapad|slate|touchpad|playbook|toshiba|xoom/.test(ua);this.gameConsole=/(nintendo|wiiu|3ds|playstation|xbox)/.test(ua);this.tv=/(google|apple|smart|hbb|opera|pov|net).*tv|(lg|aquos|inettv).*browser|(roku|kylo|aquos|viera|espial|boxee|dlnadoc|crkey|ce-html)/.test(ua);this.desktop=!this.mobile&&!this.tablet&&!this.gameConsole&&!this.tv||window.screenX!=0};DeviceInfo.prototype.getDistortedFieldOfViewLeftEye=function(){var viewer=this.viewer;var device=this.device;var distortion=new Distortion(viewer.distortionCoefficients);var eyeToScreenDistance=viewer.screenLensDistance;var outerDist=(device.widthMeters-viewer.interLensDistance)/2;var innerDist=viewer.interLensDistance/2;var bottomDist=viewer.baselineLensDistance-device.bevelMeters;var topDist=device.heightMeters-bottomDist;var outerAngle=Util.radToDeg(Math.atan(distortion.distort(outerDist/eyeToScreenDistance)));var innerAngle=Util.radToDeg(Math.atan(distortion.distort(innerDist/eyeToScreenDistance)));var bottomAngle=Util.radToDeg(Math.atan(distortion.distort(bottomDist/eyeToScreenDistance)));var topAngle=Util.radToDeg(Math.atan(distortion.distort(topDist/eyeToScreenDistance)));return{leftDegrees:Math.min(outerAngle,viewer.fov),rightDegrees:Math.min(innerAngle,viewer.fov),downDegrees:Math.min(bottomAngle,viewer.fov),upDegrees:Math.min(topAngle,viewer.fov)}};DeviceInfo.prototype.getFieldOfViewLeftEye=function(opt_isUndistorted){return opt_isUndistorted?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()};DeviceInfo.prototype.getFieldOfViewRightEye=function(opt_isUndistorted){var fov=this.getFieldOfViewLeftEye(opt_isUndistorted);return{leftDegrees:fov.rightDegrees,rightDegrees:fov.leftDegrees,upDegrees:fov.upDegrees,downDegrees:fov.downDegrees}};DeviceInfo.prototype.getProjectionMatrixLeftEye=function(opt_isUndistorted){var fov=this.getFieldOfViewLeftEye(opt_isUndistorted);var projectionMatrix=new THREE.Matrix4;var near=.1;var far=1e3;var left=Math.tan(Util.degToRad(fov.leftDegrees))*near;var right=Math.tan(Util.degToRad(fov.rightDegrees))*near;var bottom=Math.tan(Util.degToRad(fov.downDegrees))*near;var top=Math.tan(Util.degToRad(fov.upDegrees))*near;projectionMatrix.makeFrustum(-left,right,-bottom,top,near,far);return projectionMatrix};DeviceInfo.prototype.getUndistortedViewportLeftEye=function(){var p=this.getUndistortedParams_();var viewer=this.viewer;var device=this.device;var eyeToScreenDistance=viewer.screenLensDistance;var screenWidth=device.widthMeters/eyeToScreenDistance;var screenHeight=device.heightMeters/eyeToScreenDistance;var xPxPerTanAngle=device.width/screenWidth;var yPxPerTanAngle=device.height/screenHeight;var x=Math.round((p.eyePosX-p.outerDist)*xPxPerTanAngle);var y=Math.round((p.eyePosY-p.bottomDist)*yPxPerTanAngle);return{x:x,y:y,width:Math.round((p.eyePosX+p.innerDist)*xPxPerTanAngle)-x,height:Math.round((p.eyePosY+p.topDist)*yPxPerTanAngle)-y}};DeviceInfo.prototype.getUndistortedFieldOfViewLeftEye=function(){var p=this.getUndistortedParams_();return{leftDegrees:Util.radToDeg(Math.atan(p.outerDist)),rightDegrees:Util.radToDeg(Math.atan(p.innerDist)),downDegrees:Util.radToDeg(Math.atan(p.bottomDist)),upDegrees:Util.radToDeg(Math.atan(p.topDist))}};DeviceInfo.prototype.getUndistortedParams_=function(){var viewer=this.viewer;var device=this.device;var distortion=new Distortion(viewer.distortionCoefficients);var eyeToScreenDistance=viewer.screenLensDistance;var halfLensDistance=viewer.interLensDistance/2/eyeToScreenDistance;var screenWidth=device.widthMeters/eyeToScreenDistance;var screenHeight=device.heightMeters/eyeToScreenDistance;var eyePosX=screenWidth/2-halfLensDistance;var eyePosY=(viewer.baselineLensDistance-device.bevelMeters)/eyeToScreenDistance;var maxFov=viewer.fov;var viewerMax=distortion.distortInverse(Math.tan(Util.degToRad(maxFov)));var outerDist=Math.min(eyePosX,viewerMax);var innerDist=Math.min(halfLensDistance,viewerMax);var bottomDist=Math.min(eyePosY,viewerMax);var topDist=Math.min(screenHeight-eyePosY,viewerMax);return{outerDist:outerDist,innerDist:innerDist,topDist:topDist,bottomDist:bottomDist,eyePosX:eyePosX,eyePosY:eyePosY}};module.exports=DeviceInfo},{"./device/device-list.js":3,"./distortion/distortion.js":5,"./util.js":9,"./viewer-info.js":10}],3:[function(require,module,exports){function DeviceList(){this.DEVICE_ALL=0,this.DEVICE_IPHONE=1,this.DEVICE_IPAD=2,this.DEVICE_IPOD=3,this.DEVICE_ANDROID=4,this.DEVICE_WINDOWS_PHONE=5,this.DEVICE_TIZEN=6,this.DEVICE_BLACKBERRY=7,this.DEVICE_GAME_CONSOLE=8,this.DEVICE_TV=9;this.ERROR=-1;this.ONLINE_DPDB_URL="https://storage.googleapis.com/cardboard-dpdb/dpdb.json";this.getList=function(whichList){if(!whichList){whichList=this.DEVICE_ALL}switch(whichList){case this.DEVICE_ALL:return this.merge(this.list.iphone,this.list.ipad,this.list.ipod,this.list.android,this.list.windowsphone,this.list.blackberry,this.list.tizen,this.list.gameconsole,this.list.tv);break;case this.DEVICE_IPHONE:return this.list.iphone;break;case this.DEVICE_IPAD:return this.list.ipad;break;case this.DEVICE_IPOD:return this.list.ipod;break;case this.DEVICE_ANDROID:return this.list.android;break;case this.DEVICE_WINDOWS_PHONE:return this.list.windowsphone;break;case this.DEVICE_BLACKBERRY:return this.list.blackberry;break;case this.DEVICE_TIZEN:return this.list.tizen;break;case this.DEVICE_GAME_CONSOLE:return this.list.gameConsole;break;case this.DEVICE_TV:return this.list.tv;default:return{};break}};this.metersFromPixels_=function(px,ppi){if(px&&ppi&&ppi>0){return px/ppi*.0254}return this.ERROR};this.getDiagonal_=function(w,h){return Math.sqrt(w*w+h*h)};this.getDefault=function(display){var ppi=96*display.pixelRatio;var w=display.screenWidth;var h=display.screenHeight;return{label:"Default Device (by feature detect)",detect:function(ua,display,tests){return false},width:w,height:h,diag:this.getDiagonal_(w,h)/ppi,ppi:ppi,pxlr:display.pixelRatio,widthMeters:this.metersFromPixels_(w,ppi),heightMeters:this.metersFromPixels_(h,ppi),bevelMeters:0}};this.merge=function(){for(var i=1;i<arguments.length;i++){for(var a in arguments[i]){arguments[0][a]=arguments[i][a]}}return arguments[0]};this.getDPDB=function(ua){fetch(this.ONLINE_DPDB_URL,{method:"get"}).then(function(response){var dpdb=JSON.parse(response);if(dpdb){var width=Util.getScreenWidth();var height=Util.getScreenHeight();for(var i in dpdb.devices){var device=dpdb.devices[i];if(device.rules){for(var j=0;j<device.rules.length;j++){var rule=dpdb.rules[j];if(rule.ua&&rule.res){if(rule.ua&&ua.indexOf(rule.ua)>=0){console.log("found device:"+rule.ua);break}}}}}}}).catch(function(err){})};this.list={};this.list.iphone={iphone3:{label:"iPhone 1, 2, 3",detect:function(ua,display,tests){return display.longest<=480&&!display.retina&&tests.glVersion.indexOf("535")>=0},width:360,height:480,diag:3.5,ppi:163,pxlr:1,widthMeters:.0492,heightMeters:.628,bevelMeters:0},iphone4:{label:"iPhone 4, 4s",detect:function(ua,display,tests){return display.longest<=480&&display.retina&&tests.glVersion.indexOf("535")>=0},width:640,height:960,diag:3.5,ppi:326,pxlr:1,widthMeters:.075,heightMeters:.0495,bevelMeters:.004},iphone5:{label:"iPhone 5, 5c",detect:function(ua,display,tests){return display.longest<=568&&tests.glVersion.indexOf("543")>=0},width:640,height:1136,diag:4,ppi:326,pxlr:2,widthMeters:.09011,heightMeters:.05127,bevelMeters:.00343},iphone5s:{label:"iPhone 5s",detect:function(ua,display,tests){return display.longest<=568&&tests.glVersion.indexOf("a7")>=0},width:640,height:1136,diag:4,ppi:326,pxlr:2,widthMeters:.09011,heightMeters:.05127,bevelMeters:.00343},iphone6:{label:"iPhone 6",detect:function(ua,display,tests){return display.longest<=736&&tests.glVersion.indexOf("a8")>=0},width:750,height:1334,diag:4.7,ppi:326,pxlr:2,widthMeters:.1038,heightMeters:.0584,bevelMeters:.004},iphone6s:{label:"iPhone 6s",detect:function(ua,display,tests){return display.longest<=736&&tests.glVersion.indexOf("a9")>=0},width:750,height:1334,diag:4.7,ppi:326,pxlr:2,widthMeters:.1038,heightMeters:.0584,bevelMeters:.004},iphone6plus:{label:"iPhone 6 Plus",detect:function(ua,display,tests){return display.longest<=736&&tests.glVersion.indexOf("a8")>=0},width:1242,height:2208,diag:5.5,ppi:401,pxlr:2.46,widthMeters:.12235,heightMeters:.06954,bevelMeters:.00471}};this.list.ipad={ipad1:{label:"ipad1",detect:function(ua,display,tests){if(display.retina&&!tests.devicemotion){return false}return true},width:1024,height:768,diag:9.7,ppi:132,pxlr:1,widthMeters:.1924,heightMeters:.1477,bevelMeters:0},ipad2:{label:"iPad 2",detect:function(ua,display,tests){if(display.retina&&display.longest<=1024&&/543/.test(tests.glVersion)){return false}},width:1024,height:768,diag:9.7,ppi:132,pxlr:1,widthMeters:.1924,heightMeters:.1477,bevelMeters:0},ipad3:{label:"iPad 3",detect:function(ua,display,tests){return display.retina&&display.longest<=2048&&/543/.test(tests.glVersion)},width:2048,height:1536,diag:9.7,ppi:264,pxlr:2,widthMeters:.197,heightMeters:.1478,bevelMeters:0},ipad4:{label:"iPad 4",detect:function(ua,display,tests){return display.retina&&display.longest<=2048&&/554/.test(tests.glVersion)},width:2048,height:1536,diag:9.7,ppi:264,pxlr:2,widthMeters:.197,heightMeters:.1478,bevelMeters:0},ipadair:{label:"iPad Air",detect:function(ua,display,tests){return display.retina&&display.longest<=2048&&/A7/.test(tests.glVersion)},width:2048,height:1536,diag:9.7,ppi:264,pxlr:2,widthMeters:.197,heightMeters:.1478,bevelMeters:0},ipadair2:{label:"iPad Air 2",detect:function(ua,display,tests){return display.retina&&display.longest<=2048&&/A8X/.test(tests.glVersion)},width:2048,height:1536,diag:9.7,ppi:264,pxlr:2,widthMeters:.197,heightMeters:.1478,bevelMeters:0},ipadpro:{label:"iPad Pro",detect:function(ua,display,tests){return display.retina&&display.longest<=2732&&/A9/.test(tests.glVersion)},width:2732,height:2048,diag:12.9,ppi:264,pxlr:2,widthMeters:.2628,heightMeters:.197,bevelMeters:0},ipadmini:{label:"iPad Mini",detect:function(ua,display,tests){return!display.retina&&/A7/.test(tests.glVersion)},width:1024,height:768,diag:7.9,ppi:163,pxlr:1,widthMeters:.1595,heightMeters:.1197,bevelMeters:0},ipadmini3:{label:"iPad Mini Retina 2 and 3",detect:function(ua,display,tests){return display.retina&&display.longest<=2048&&/A7/.test(tests.glVersion)},width:2048,height:1536,diag:7.9,ppi:326,pxlr:2,widthMeters:.1596,heightMeters:.12,bevelMeters:0},ipadmini4:{label:"iPad Mini 4",detect:function(ua,display,tests){return display.retina&&/A8/.test(tests.glVersion)},width:2048,height:1536,diag:7.9,ppi:326,pxlr:2,widthMeters:.1596,heightMeters:.12,bevelMeters:0}};this.list.ipod={ipodtouch3:{label:"iPod Touch 3",detect:function(ua,display,tests){return!display.retina&&display.longest<=480},width:480,height:320,diag:3,ppi:163,pxlr:1,widthMeters:.0748,heightMeters:.0498,bevelMeters:0},ipodtouch4:{label:"iPod Touch 4",detect:function(ua,display,tests){return display.retina&&display.longest<=480},width:960,height:640,diag:3.5,ppi:326,pxlr:2,widthMeters:.0748,heightMeters:.0498,bevelMeters:0},ipodtouch5:{label:"iPod Touch 5",detect:function(ua,display,tests){return display.retina&&display.longest>480&&!/A8/.test(tests.glVersion)},width:1136,height:640,diag:4,ppi:326,pxlr:2,widthMeters:.0885,heightMeters:.0498,bevelMeters:0},ipodtouch6:{label:"iPod Touch 6",detect:function(ua,display,tests){return display.retina&&display.longest>480&&/A8/.test(tests.glVersion)},width:1136,height:640,diag:4,ppi:326,pxlr:2,widthMeters:.0885,heightMeters:.0498,bevelMeters:0}};this.list.android={note4:{label:"Note 4",detect:function(ua,display,tests){return ua.indexOf("sm-n910c")>=0},width:2560,height:1440,diag:5.7,ppi:515,pxlr:4,widthMeters:.125,heightMeters:.7,bevelMeters:0},note5:{label:"Note 5",detect:function(ua,display,tests){return ua.indexOf("sm-a920")>=0},width:2560,height:1440,diag:5.7,ppi:515,widthMeters:.125,heightMeters:.7,bevelMeters:0},nexus5:{label:"Nexus 5",detect:function(ua,display,tests){return ua.indexOf("nexus 5 ")>=0},width:1920,height:1080,diag:5,ppi:441,widthMeters:.11,heightMeters:.062,bevelMeters:.004},nexus6:{label:"Nexus 6",detect:function(ua,display,tests){return ua.indexOf("nexus 6")>=0},width:2560,height:1440,diag:5.93,ppi:493,width:2560,height:1440,widthMeters:.132,heightMeters:.074,bevelMeters:.004},nexus6p:{label:"Nexus 6p",detect:function(ua,display,tests){return ua.indexOf("nexus 6p")>=0},width:2560,height:1440,diag:5.7,ppi:515,widthMeters:.126,heightMeters:.0705,bevelMeters:.004},galaxygrand:{label:"Galaxy Grand",detect:function(ua,display,tests){return ua.indexOf("sm-g7102")>=0},width:800,height:480,diag:5,ppi:187,widthMeters:.109,heightMeters:.065,bevelMeters:.004},galaxygrandprime:{label:"Galaxy Grand Prime",detect:function(ua,display,tests){return ua.indexOf("sm-g530h")>=0},width:960,height:540,diag:5,ppi:220,widthMeters:.1108,heightMeters:.0623,bevelMeters:0},galaxys3:{label:"Galaxy S3",detect:function(ua,display,tests){return ua.indexOf("gt-i9300")>=0},width:0,height:0,diag:4.8,ppi:306,pxlr:2,widthMeters:.106,heightMeters:.06,bevelMeters:.005},galaxys4:{label:"Galaxy S4",detect:function(ua,display,tests){return ua.indexOf("gt-i9505")>=0},width:1920,height:1080,diag:5,ppi:441,pxlr:3,widthMeters:.111,heightMeters:.0625,bevelMeters:.004},galaxys5:{label:"Galaxy S5",detect:function(ua,display,tests){return/(sm-g900|scl23|sc04f)/.test(ua)},width:0,height:0,diag:5.1,ppi:432,pxlr:3,widthMeters:.113,heightMeters:.066,bevelMeters:.005},galaxys5mini:{label:"Galaxy S5 Mini",detect:function(ua,display,tests){return ua.indexOf("sm-g800f")>=0},width:1280,height:720,diag:4.5,ppi:326,pxlr:2,widthMeters:.0997,heightMeters:.561,bevelMeters:0},galaxys6:{label:"Galaxy S6",detect:function(ua,display,tests){return ua.indexOf("sm-g920")>=0;return/(sm-g950|sm-g925)/.test(ua)},width:2560,height:1440,diag:5.1,ppi:576,pxlr:4,widthMeters:.114,heightMeters:.0635,bevelMeters:.0035},galaxya3:{label:"Galaxy A3",detect:function(ua,display,tests){return ua.indexOf("sm-a300")>=0},width:1280,height:720,diag:4.7,ppi:312,widthMeters:.1042,heightMeters:.0586,bevelMeters:0},galaxya5:{label:"Galaxy A5",detect:function(ua,display,tests){return/sm-(a500|a510)/.test(ua)},width:1920,height:1080,diag:5.2,ppi:424,widthMeters:.1329,heightMeters:.0747,bevelMeters:0},galaxya7:{label:"Galaxy A7",detect:function(ua,display,tests){return ua.indexOf("sm-a700")>=0},width:1920,height:1080,diag:5.5,ppi:401,widthMeters:.1216,heightMeters:.0684,bevelMeters:0},galaxya9:{label:"Galaxy A9",detect:function(ua,display,tests){return ua.indexOf("sm-a900")>=0},width:1920,height:1080,diag:6,ppi:367,widthMeters:.1329,heightMeters:.0747,bevelMeters:0},htcone:{label:"HTC One",detect:function(ua,display,tests){return!ua.indexOf("max")>=0&&/htc.*one/.test(ua)},width:1920,height:1080,diag:5,ppi:441,pxlr:3,widthMeters:.1102,heightMeters:.0622,bevelMeters:0},htconemax:{label:"HTC One Max",detect:function(ua,display,tests){return/htc.*one.*max/.test(ua)},width:1920,height:1080,diag:5.9,ppi:373,widthMeters:.1307,heightMeters:.735,bevelMeters:0},lgg2:{label:"LG G2",detect:function(ua,display,tests){return ua.indexOf("lg-d802 ")>=0},width:1920,height:1080,diag:5.2,ppi:424,widthMeters:.115,heightMeters:.0639,bevelMeters:0},lgg3:{label:"LG G3",detect:function(ua,display,tests){return/lg-d(850|851)/.test(ua)},width:2560,height:1440,diag:5.5,ppi:538,widthMeters:.1209,heightMeters:.068,bevelMeters:0},lgg4:{label:"LG G4",detect:function(ua,display,tests){return indexOf("lg-h815")>=0},width:2560,height:1440,diag:5.5,ppi:538,widthMeters:.1209,heightMeters:.068,bevelMeters:0},oneplusone:{label:"OnePlus One",detect:function(ua,display,tests){return indexOf("mi-oneplus")>=0},width:1920,height:1080,diag:5.2,ppi:424,widthMeters:.115,heightMeters:.068,bevelMeters:0},zenfone6:{label:"ASUS ZenFone 6",detect:function(ua,display,tests){return/'(?:asus_)?(?:t00g|z002)/.test(ua)},width:1280,height:720,diag:6,ppi:245,widthMeters:.1327,heightMeters:.746,bevelMeters:0},kindlehdx7:{label:'Kindle Fire HDX 7"',detect:function(ua,display,tests){return ua.indexOf("kfthwi")>=0},width:1920,height:1200,diag:7,ppi:339,pxlr:2,widthMeters:.1438,heightMeters:.0899,bevelMeters:0},kindlehdx89:{label:'Kindle Fire HDX 8.9"',detect:function(ua,display,tests){return ua.indexOf("kfapwi")>=0},width:2560,height:1600,diag:8.9,ppi:339,pxlr:2,widthMeters:.1918,heightMeters:.1199,bevelMeters:0}};this.list.windowsphone={lumina1520:{label:"Lumina 1520",detect:function(ua,display,tests){return ua.indexOf("lumina 1520")>=0},width:1920,height:1080,diag:6,ppi:367,widthMeters:.1329,heightMeters:.0747,bevelMeters:0},lumina950:{label:"Lumina 950",detect:function(ua,display,tests){return ua.indexOf("lumina 950")>=0},width:2560,height:1440,diag:5.2,ppi:565,widthMeters:.115,heightMeters:.0647,bevelMeters:0},lumina930:{label:"Lumina 930",detect:function(ua,display,tests){return ua.indexOf("lumina 930")>=0},width:1920,height:1080,diag:4.7,ppi:441,pxlr:2.6,widthMeters:.1106,heightMeters:.0622,bevelMeters:0},lumina550:{label:"Lumina 550",detect:function(ua,display,tests){return ua.indexOf("lumina 550")>=0},width:1280,height:720,widthMeters:.1032,heightMeters:.058,bevelMeters:0},lumina530:{label:"Lumina 530",detect:function(ua,display,tests){return ua.indexOf("lumina 530")>=0},width:854,height:480,diag:4,ppi:245,widthMeters:.0885,heightMeters:.0498,bevelMeters:0},lumina520:{label:"Lumina 520",detect:function(ua,display,tests){return ua.indexOf("lumina 520")>=0},width:800,height:480,diag:4,ppi:233,pxlr:1.4,widthMeters:.0872,heightMeters:.0523,bevelMeters:0}};this.list.blackberry={blackberryleap:{label:"Blackberry Leap",detect:function(ua,display,tests){return ua.indexOf("str100")>=0},width:1280,height:720,diag:5,ppi:294,pxlr:2,widthMeters:.1105,heightMeters:.0622,bevelMeters:0},blackberrypriv:{label:"Blackberry Priv",detect:function(ua,display,tests){return ua.indexOf("stv100-3")>=0},width:2560,height:1440,diag:5.4,ppi:544,widthMeters:.1204,heightMeters:.0677,bevelMeters:0}};this.list.tizen={samsungz:{label:"Samsung Z",detect:function(ua,display,tests){return ua.indexOf("sm-910f")>=0},width:1280,height:720,diag:4.8,ppi:306,widthMeters:.1062,heightMeters:.0598,bevelMeters:0},samsungz3:{label:"Samsung Z3",detect:function(ua,display,tests){return ua.indexOf("sm-z300")>=0},width:1280,height:720,widthMeters:.1106,heightMeters:.0622,bevelMeters:0}};this.list.gameConsole={};this.list.tv={}}module.exports=DeviceList},{}],4:[function(require,module,exports){var BarrelDistortionFragment={type:"fragment_v2",uniforms:{texture:{type:"t",value:null},distortion:{type:"v2",value:new THREE.Vector2(.441,.156)},projectionLeft:{type:"v4",value:new THREE.Vector4(1,1,-.5,-.5)},unprojectionLeft:{type:"v4",value:new THREE.Vector4(1,1,-.5,-.5)},backgroundColor:{type:"v4",value:new THREE.Vector4(0,0,0,1)},showCenter:{type:"i",value:0},dividerColor:{type:"v4",value:new THREE.Vector4(.5,.5,.5,1)}},vertexShader:["varying vec2 vUV;","void main() {","vUV = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D texture;","uniform vec2 distortion;","uniform vec4 backgroundColor;","uniform vec4 projectionLeft;","uniform vec4 unprojectionLeft;","uniform int showCenter;","uniform vec4 dividerColor;","varying vec2 vUV;","float poly(float val) {","return (showCenter == 1 && val < 0.00005) ? ","10000.0 : 1.0 + (distortion.x + distortion.y * val) * val;","}","vec2 barrel(vec2 v, vec4 projection, vec4 unprojection) {","vec2 w = (v + unprojection.zw) / unprojection.xy;","return projection.xy * (poly(dot(w, w)) * w) - projection.zw;","}","void main() {","vec4 projectionRight = ","(projectionLeft + vec4(0.0, 0.0, 1.0, 0.0)) * vec4(1.0, 1.0, -1.0, 1.0);","vec4 unprojectionRight = ","(unprojectionLeft + vec4(0.0, 0.0, 1.0, 0.0)) * vec4(1.0, 1.0, -1.0, 1.0);","vec2 a = (vUV.x < 0.5) ? ","barrel(vec2(vUV.x / 0.5, vUV.y), projectionLeft, unprojectionLeft) : ","barrel(vec2((vUV.x - 0.5) / 0.5, vUV.y), projectionRight, unprojectionRight);","if (dividerColor.w > 0.0 && abs(vUV.x - 0.5) < .001) {","} else if (a.x < 0.0 || a.x > 1.0 || a.y < 0.0 || a.y > 1.0) {","gl_FragColor = backgroundColor;","} else {","gl_FragColor = texture2D(texture, vec2(a.x * 0.5 + (vUV.x < 0.5 ? 0.0 : 0.5), a.y));","}","}"].join("\n")};module.exports=BarrelDistortionFragment},{}],5:[function(require,module,exports){function Distortion(coefficients){this.coefficients=coefficients}Distortion.prototype.distortInverse=function(radius){var r0=radius/.9;var r1=radius*.9;var dr0=radius-this.distort(r0);while(Math.abs(r1-r0)>1e-4){var dr1=radius-this.distort(r1);var r2=r1-dr1*((r1-r0)/(dr1-dr0));r0=r1;r1=r2;dr0=dr1}return r1};Distortion.prototype.distort=function(radius){
return radius*this.distortionFactor_(radius)};Distortion.prototype.distortionFactor_=function(radius){var result=1;var rFactor=1;var rSquared=radius*radius;for(var i=0;i<this.coefficients.length;i++){var ki=this.coefficients[i];rFactor*=rSquared;result+=ki*rFactor}return result};module.exports=Distortion},{}],6:[function(require,module,exports){function Emitter(){this.callbacks={}}Emitter.prototype.emit=function(eventName){var callbacks=this.callbacks[eventName];if(!callbacks){return}var args=[].slice.call(arguments);args.shift();for(var i=0;i<callbacks.length;i++){callbacks[i].apply(this,args)}};Emitter.prototype.on=function(eventName,callback){if(eventName in this.callbacks){this.callbacks[eventName].push(callback)}else{this.callbacks[eventName]=[callback]}};module.exports=Emitter},{}],7:[function(require,module,exports){var WebVRPageManager=require("./webvr-page-manager.js");window.WebVRPageConfig=window.WebVRPageConfig||{};window.WebVRPageManager=WebVRPageManager},{"./webvr-page-manager.js":14}],8:[function(require,module,exports){var Modes={UNKNOWN:"unknown",DOM:"dom",FULLSCREEN:"fullscreen",VR:"vr",REQUEST_FULLSCREEN:"requestfullscreen",EXIT_FULLSCREEN:"exitfullscreen",BACK:"back",INFO:"info"};var ViewStates={UNKNOWN:"unknown",THUMBNAIL:"thumbnail",DOM:"dom",FULLSCREEN:"fullscreen",VR:"vr"};var ElementStates={IN_DOM:"text-in-dom",IN_SPRITE:"text-in-sprite"};var DialogTypes={DIALOG:"dialog",DIALOG_ALERT:"alert",DIALOG_DEVICE_MENU:"device-menu",DIALOG_HMD_SELECT:"hmd-select"};var PanelTypes={PANEL:"panel",PANEL_STATE:"panel-state",PANEL_BACK:"panel-back",TOP_LEFT:"topleft",TOP_RIGHT:"topright",BOTTOM_LEFT:"bottomleft",BOTTOM_RIGHT:"bottomright",CENTER_TOP:"centertop",CENTER_BOTTOM:"centerbottom",CENTER_CENTER:"centercenter"};var ButtonTypes={BUTTON_CARDBOARD:"cardboard",BUTTON_HMD:"hmd",BUTTON_FULLSCREEN:"fullscreen",BUTTON_VR:"vr",BUTTON_EXIT_FULLSCREEN:"exitfullscreen",BUTTON_BACK:"back",BUTTON_SETTINGS:"settings",BUTTON_SETTINGS_DEVICE:"settings-device"};module.exports.Modes=Modes;module.exports.ViewStates=ViewStates;module.exports.DialogTypes=DialogTypes;module.exports.PanelTypes=PanelTypes;module.exports.ButtonTypes=ButtonTypes},{}],9:[function(require,module,exports){var Util={};Util.hasCrypto=typeof window.crypto!="undefined"&&typeof window.crypto.getRandomValues!="undefined";Util.getUUID=Util.hasCrypto?function(){var buf=new Uint16Array(8);var crypto=window.crypto||window.msCrypto;crypto.getRandomValues(buf);var S4=function(num){var ret=num.toString(16);while(ret.length<4){ret="0"+ret}return ret};return S4(buf[0])+S4(buf[1])+"-"+S4(buf[2])+"-"+S4(buf[3])+"-"+S4(buf[4])+"-"+S4(buf[5])+S4(buf[6])+S4(buf[7])}:function b(a){console.warn("Warning - GUID not cryptographically secure");return a?(a^Math.random()*16>>a/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,b)};Util.getUniqueIncrementingId=function(prefix){var i=Math.floor(Math.random()*999)+100;var pfx=prefix||"";function inc(pfx){if(!pfx){pfx=""}else{pfx+="-"}return pfx+i++}return inc}();Util.base64=function(mimeType,base64){return"data:"+mimeType+";base64,"+base64};Util.hasClass=function(elem,className){if(elem.classList){return elem.classList.contains(className)}else if(elem.className.indexOf(className)>=0){return true}return false};Util.addClass=function(elem,className){if(elem.classList){elem.classList.add(className)}else if(!this.hasClass(elem,className)){if(elem.className==""){elem.className=className}else{elem.className+=" "+className}}};Util.removeClass=function(elem,className){if(elem.classList){elem.classList.remove(className)}else if(this.hasClass(elem,className)){var reg=new RegExp("(\\s|^)"+className+"(\\s|$)");elem.className=elem.className.replace(reg," ")}};Util.getChildrenByTagName=function(elem,tagName){var arr=[],c=elem.children,len=c.length;var t=tagName.toUpperCase();for(var i=0;i<len;i++){if(t==c[i].tagName){arr.push(c[i])}}return arr};Util.getElementWidth=function(elem){var w;if(elem.style.clip){w=elem.style.clip.width}else if(elem.style.pixelWidth){w=elem.style.pixelWidth}else{w=elem.offsetWidth}return parseFloat(w)};Util.getElementHeight=function(elem){var h;if(elem.style.clip){h=elem.style.clip.height}else if(elem.style.pixelHeight){h=elem.style.pixelHeight}else{h=elem.offsetHeight}return parseFloat(h)};Util.radToDeg=function(rads){if(THREE&&THREE.Math){return THREE.Math.radToDeg(rads)}console.error("radToDeg not supported by your 3d library");return 0};Util.degToRad=function(degs){if(THREE&&THREE.Math){return THREE.Math.degToRad(degs)}console.error("degToRad not supported by your 3d library");return 0};Util.fullscreenClass=function(fullscreenClass){var head=document.getElementsByTagName("head")[0];var s=document.createElement("style");s.type="text/css";s.id="webvr-util-fullscreen-style";var rules="."+fullscreenClass+" {\n"+"	position: fixed !important;\n"+"	box-sizing: border-box !important;\n"+"	width: 100% !important;\n"+"	height: 100% !important;\n"+"	margin: 0 !important;\n"+"	left: 0 !important;\n"+"	top: 0 !important;\n"+" right:0 !important;\n"+" bottom:0 !important;\n"+"	z-index: 2147483647 !important;\n"+" background:black !important;\n"+"}\n";if(s.styleSheet){s.styleSheet.cssText=rules}else{var ruleNode=document.createTextNode(rules);s.appendChild(ruleNode)}head.appendChild(s);return fullscreenClass}("polyfill-full-screen");Util.isFullScreen=function(){if(document.fullscreenElement||window.navigator.standalone){return true}return false};Util.isAppMode=function(){return!!window.navigator.standalone};(function(){var hasStyles=false;document.fullscreenElement=null;if(!("fullscreenEnabled"in document)){Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.msFullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||function(){console.log("entering fullscreenEnabled polyfill function");var iframes=document.getElementsByTagName("iframe");for(var i=0;i<iframes.length;i++){console.log("trying iframe number:"+i);if(!iframes[i].allowfullscreen){console.log("found an iframe");return false}}return true}()}})}var escHandler=function(e){if(e.keyCode==27){e.stopImmediatePropagation();document.exitFullscreen()}};Element.prototype.requestFullscreen=Element.prototype.requestFullscreen||Element.prototype.webkitRequestFullscreen||Element.prototype.mozRequestFullScreen||Element.prototype.msRequestFullscreen||function(hmd){console.log("in requestFullscreen() polyfill");console.log("IN REQUESTFULLSCREEN, fullscreen element set to:"+("fullscreenElement"in document)+" and typeof:"+typeof document.fullscreenElement+" and value:"+document.fullscreenElement);if(this.nodeName==="IFRAME"&&!this.allowfullscreen){console.Error("invalid iframe, setting fullscreenElement to NULL");document.fullscreenElement=null;return}if(document.fullscreenElement===null){document.fullscreenElement=this}document.addEventListener("keydown",escHandler,false);console.log("adding fullscreen class:"+Util.fullscreenClass);Util.addClass(this,Util.fullscreenClass);var event=new CustomEvent("fullscreenchange");if(typeof document.onfullscreenchange=="function"){console.log("dispatching from onfullscreenchange in requestFullscreen")}else{console.log("dispatching fullscreenchange in requestFullscreen");document.dispatchEvent(event)}};var toFS="true";var screenChange=function(e){e.stopImmediatePropagation();if(toFS==="true"){document.fullscreenElement=e.target;toFS="false"}else{toFS="true";document.fullscreenElement=null}console.log("dispatching fullscreenchange in screenChange, toggle:"+toFS);var bob=document.fullscreenElement;var event=new CustomEvent("fullscreenchange",e);document.dispatchEvent(event)};document.addEventListener("webkitfullscreenchange",screenChange);document.addEventListener("mozfullscreenchange",screenChange);document.addEventListener("MSFullscreenChange",screenChange);document.exitFullscreen=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen||function(d){d.d=true;if(document.fullscreenEnabled===true){document.removeEventListener("keydown",escHandler,false);var event=new CustomEvent("fullscreenchange");if(typeof document.onfullscreenchange=="function"){document.onfullscreenchange(event)}else{document.dispatchEvent(event)}}};var screenError=function(e){console.error("A fullscreen request error has occurred");e.stopImmediatePropagation();var event=new CustomEvent("fullscreenerror",e);document.dispatchEvent(event)};document.addEventListener("webkitfullscreenerror",screenError,false);document.addEventListener("mozfullscreenerror",screenError,false);document.addEventListener("MSFullscreenError",screenError,false)})();Util.parseText=function(str){return str.replace(/[0-9]/g,"")};Util.getQueryParameter=function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results===null?"":decodeURIComponent(results[1].replace(/\+/g," "))};Util.isLandscapeMode=function(){return window.orientation==90||window.orientation==-90};Util.getScreenWidth=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio};Util.getScreenHeight=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio};module.exports=Util},{}],10:[function(require,module,exports){var Util=require("./util.js");var ViewerList=require("./viewer/viewer-list.js");function ViewerInfo(params){this.viewer=null;this.viewerList=new ViewerList;if(params.viewerName){this.setViewer(params.viewerName)}else{this.getViewer()}}ViewerInfo.prototype.getViewer=function(){if(!this.viewer){this.detectViewer_()}return this.viewer};ViewerInfo.prototype.setViewer=function(viewerName){if(viewerName){return this.detectViewer_(viewerName)}console.error("ViewerInfo.setViewer(), no viewer name set");return{}};ViewerInfo.prototype.getViewerNames=function(viewerList){var names=[];var list=this.viewerList.getList(viewerList);for(var i in list){names.push(i)}list=null;return names};ViewerInfo.prototype.getViewerLabels=function(viewerList){var labels=[];if(!viewerList){viewerList=this.viewerList.VIEWER_ALL}var list=this.viewerList.getList(viewerList);for(var i in list){labels.push(list[i].label)}list=null;return labels};ViewerInfo.prototype.getViewerByName=function(viewerName){var list=this.viewerList.getList(this.viewerList.VIEWER_ALL);var viewer=list[viewerName];if(viewer){return viewer}console.error("Viewer "+viewerName+" not found in lists");return{}};ViewerInfo.prototype.detectViewer_=function(){console.warn("using generic viewer");this.viewer=this.viewerList.getDefault();return this.viewer};ViewerInfo.prototype.searchViewer=function(keywords){};ViewerInfo.prototype.getDefaultFOV_=function(){return{downDegrees:40,leftDegrees:40,rightDegrees:40,upDegrees:40}};module.exports=ViewerInfo},{"./util.js":9,"./viewer/viewer-list.js":11}],11:[function(require,module,exports){function ViewerList(){this.VIEWER_ALL=0,this.VIEWER_CARDBOARD=1;this.getList=function(whichList){if(!whichList){whichList=this.VIEWER_ALL}switch(whichList){case this.VIEWER_ALL:return this.merge(this.list.cardboard);break;case this.VIEWER_CARDBOARD:return this.list.cardboard;break;default:return{};break}};this.getDefault=function(){return{label:"Default Viewer (Cardboard I/O 2015)",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]}};this.merge=function(){for(var i=1;i<arguments.length;i++){for(var a in arguments[i]){arguments[0][a]=arguments[i][a]}}return arguments[0]};this.list={};this.list.cardboard={cardboardv1:{label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]},cardboardv2:{label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]}}}module.exports=ViewerList},{}],12:[function(require,module,exports){var Emitter=require("./emitter.js");var Modes=require("./modes.js");var Util=require("./util.js");function WebVRPageButtons(type,position,container,params){this.buttonClasses={button:"-button",panel:"-"+Modes.PanelTypes.PANEL};this.dom=null;this.buttons=[];this.container=container;this.params=params||{uid:Util.getUniqueIncrementingId()};this.uid=this.params.uid;this.buttonScale=.05;this.buttonPadding="12";this.loadIcons_();this.initPanel_(type,position);this.ready=true}WebVRPageButtons.prototype=new Emitter;WebVRPageButtons.prototype.getPanelId=function(){return this.uid+"-"+this.type};WebVRPageButtons.prototype.initPanel_=function(type,panelPosition){this.dom=document.createElement("nav");this.type=type;this.dom.id=this.getPanelId();Util.addClass(this.dom,this.params.prefix+type);this.dom.quadrant=panelPosition;var s=this.dom.style;s.width="100%";s.height=this.calcButtonSize_().height+this.buttonPadding*2+"px";s.position="absolute";this.setPanelPosition(this.dom.quadrant);var that=this;this.dom.addEventListener("click",this.createClickHandler_(),true);this.dom.addEventListener("mouseenter",function(e){e.preventDefault();e.stopPropagation();if(e.target.tagName==="IMG"){var s=e.target.style;s.filter=s.webkitFilter="drop-shadow(0 0 5px rgba(255,255,255,1))"}},true);this.dom.addEventListener("mouseleave",function(e){e.preventDefault();e.stopPropagation();if(e.target.tagName==="IMG"){var s=e.target.style;s.filter=s.webkitFilter=""}},true);this.container.appendChild(this.dom)};WebVRPageButtons.prototype.setPanelVisibility=function(mode){if(mode){this.dom.style.visibility="block"}else{this.dom.style.visibility="none"}};WebVRPageButtons.prototype.setPanelPosition=function(quadrant){this.dom.quadrant=quadrant;var s=this.dom.style;var dist="0px";switch(quadrant){case Modes.PanelTypes.TOP_LEFT:s.top=dist;s.left=dist;break;case Modes.PanelTypes.TOP_RIGHT:s.top=dist;s.right=dist;break;case Modes.PanelTypes.BOTTOM_RIGHT:s.bottom=dist;s.right=dist;break;case Modes.PanelTypes.BOTTOM_LEFT:s.bottom=dist;s.left=dist;break;case Modes.PanelTypes.CENTER_TOP:break;case Modes.PanelTypes.CENTER_BOTTOM:break;case Modes.PanelTypes.CENTER_CENTER:break;default:break}};WebVRPageButtons.prototype.getButtonId=function(buttonType){return this.uid+this.buttonClasses.button+"-"+buttonType};WebVRPageButtons.prototype.createButton=function(buttonType,display){var button=document.createElement("img");button.id=this.getButtonId(buttonType);button.type=buttonType;Util.addClass(button,this.params.prefix+this.buttonClasses.button);Util.addClass(button,this.params.prefix+this.buttonClasses.button+"-"+buttonType);var s=button.style;button.src=this.icons[buttonType];var sz=this.calcButtonSize_();s.width=sz.width+"px";s.height=sz.height+"px";s.backgroundSize="cover";s.backgroundColor="transparent";s.border=0;s.cursor="pointer";s.padding=this.buttonPadding+"px";s.marginLeft=s.padding;s.zIndex=1e5;if(display){s.display="block"}else{s.display="none"}switch(this.dom.quadrant){case Modes.PanelTypes.TOP_LEFT:case Modes.PanelTypes.BOTTOM_LEFT:s.float="left";break;case Modes.PanelTypes.TOP_RIGHT:case Modes.PanelTypes.BOTTOM_RIGHT:s.float="right";break;case Modes.PanelTypes.CENTER_TOP:break;case Modes.PanelTypes.CENTER_BOTTOM:break;default:break}button.draggable=false;button.addEventListener("dragstart",function(e){e.preventDefault()});this.buttons.push(button);this.dom.appendChild(button);return button};WebVRPageButtons.prototype.calcButtonSize_=function(){var w=parseInt(this.buttonScale*Util.getElementWidth(this.container));var h=parseInt(this.buttonScale*Util.getElementHeight(this.container));if(h<34){w=h=34;this.buttonPadding=parseInt(.1*h)}return{width:w,height:h}};WebVRPageButtons.prototype.setButtonVisibility=function(mode){};WebVRPageButtons.prototype.createClickHandler_=function(e){return function(e){e.stopPropagation();e.preventDefault();console.log("*****************ABOUT TO EMIT:"+e.target.id);this.emit(e.target.id)}.bind(this)};WebVRPageButtons.prototype.loadIcons_=function(){this.icons=[];this.icons[Modes.ButtonTypes.BUTTON_VR]=Util.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMjAuNzQgNkgzLjIxQzIuNTUgNiAyIDYuNTcgMiA3LjI4djEwLjQ0YzAgLjcuNTUgMS4yOCAxLjIzIDEuMjhoNC43OWMuNTIgMCAuOTYtLjMzIDEuMTQtLjc5bDEuNC0zLjQ4Yy4yMy0uNTkuNzktMS4wMSAxLjQ0LTEuMDFzMS4yMS40MiAxLjQ1IDEuMDFsMS4zOSAzLjQ4Yy4xOS40Ni42My43OSAxLjExLjc5aDQuNzljLjcxIDAgMS4yNi0uNTcgMS4yNi0xLjI4VjcuMjhjMC0uNy0uNTUtMS4yOC0xLjI2LTEuMjh6TTcuNSAxNC42MmMtMS4xNyAwLTIuMTMtLjk1LTIuMTMtMi4xMiAwLTEuMTcuOTYtMi4xMyAyLjEzLTIuMTMgMS4xOCAwIDIuMTIuOTYgMi4xMiAyLjEzcy0uOTUgMi4xMi0yLjEyIDIuMTJ6bTkgMGMtMS4xNyAwLTIuMTMtLjk1LTIuMTMtMi4xMiAwLTEuMTcuOTYtMi4xMyAyLjEzLTIuMTNzMi4xMi45NiAyLjEyIDIuMTMtLjk1IDIuMTItMi4xMiAyLjEyeiIvPgogICAgPHBhdGggZmlsbD0ibm9uZSIgZD0iTTAgMGgyNHYyNEgwVjB6Ii8+Cjwvc3ZnPgo=");this.icons[Modes.ButtonTypes.BUTTON_FULLSCREEN]=Util.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNNyAxNEg1djVoNXYtMkg3di0zem0tMi00aDJWN2gzVjVINXY1em0xMiA3aC0zdjJoNXYtNWgtMnYzek0xNCA1djJoM3YzaDJWNWgtNXoiLz4KPC9zdmc+Cg==");this.icons[Modes.ButtonTypes.BUTTON_EXIT_FULLSCREEN]=Util.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNNSAxNmgzdjNoMnYtNUg1djJ6bTMtOEg1djJoNVY1SDh2M3ptNiAxMWgydi0zaDN2LTJoLTV2NXptMi0xMVY1aC0ydjVoNVY4aC0zeiIvPgo8L3N2Zz4K");this.icons[Modes.ButtonTypes.BUTTON_BACK]=Util.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNMjAgMTFINy44M2w1LjU5LTUuNTlMMTIgNGwtOCA4IDggOCAxLjQxLTEuNDFMNy44MyAxM0gyMHYtMnoiLz4KPC9zdmc+Cg==");this.icons[Modes.ButtonTypes.BUTTON_SETTINGS]=Util.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNMTkuNDMgMTIuOThjLjA0LS4zMi4wNy0uNjQuMDctLjk4cy0uMDMtLjY2LS4wNy0uOThsMi4xMS0xLjY1Yy4xOS0uMTUuMjQtLjQyLjEyLS42NGwtMi0zLjQ2Yy0uMTItLjIyLS4zOS0uMy0uNjEtLjIybC0yLjQ5IDFjLS41Mi0uNC0xLjA4LS43My0xLjY5LS45OGwtLjM4LTIuNjVDMTQuNDYgMi4xOCAxNC4yNSAyIDE0IDJoLTRjLS4yNSAwLS40Ni4xOC0uNDkuNDJsLS4zOCAyLjY1Yy0uNjEuMjUtMS4xNy41OS0xLjY5Ljk4bC0yLjQ5LTFjLS4yMy0uMDktLjQ5IDAtLjYxLjIybC0yIDMuNDZjLS4xMy4yMi0uMDcuNDkuMTIuNjRsMi4xMSAxLjY1Yy0uMDQuMzItLjA3LjY1LS4wNy45OHMuMDMuNjYuMDcuOThsLTIuMTEgMS42NWMtLjE5LjE1LS4yNC40Mi0uMTIuNjRsMiAzLjQ2Yy4xMi4yMi4zOS4zLjYxLjIybDIuNDktMWMuNTIuNCAxLjA4LjczIDEuNjkuOThsLjM4IDIuNjVjLjAzLjI0LjI0LjQyLjQ5LjQyaDRjLjI1IDAgLjQ2LS4xOC40OS0uNDJsLjM4LTIuNjVjLjYxLS4yNSAxLjE3LS41OSAxLjY5LS45OGwyLjQ5IDFjLjIzLjA5LjQ5IDAgLjYxLS4yMmwyLTMuNDZjLjEyLS4yMi4wNy0uNDktLjEyLS42NGwtMi4xMS0xLjY1ek0xMiAxNS41Yy0xLjkzIDAtMy41LTEuNTctMy41LTMuNXMxLjU3LTMuNSAzLjUtMy41IDMuNSAxLjU3IDMuNSAzLjUtMS41NyAzLjUtMy41IDMuNXoiLz4KPC9zdmc+Cg==")};module.exports=WebVRPageButtons},{"./emitter.js":6,"./modes.js":8,"./util.js":9}],13:[function(require,module,exports){var Emitter=require("./emitter.js");var Modes=require("./modes.js");var Util=require("./util.js");var WebVRPageButtons=require("./webvr-page-buttons.js");function WebVRPageDialogs(params){this.DEFAULT_WIDTH=480;this.DEFAULT_HEIGHT=360;this.dialogClasses={dialog:"dialog"};this.params=params||{uid:Util.getUniqueIncrementingId()};this.uid=this.params.uid+this.dialogClasses.dialog;this.container=document.body}WebVRPageDialogs.prototype=new Emitter;WebVRPageDialogs.prototype.createDialog_=function(dialogType,container,width,height,ok,cancel,callback){this.container=container;var sz=this.adjustDialogSize_(width,height);this.dom=document.createElement("div");if(this.dom){var d=this.dom;d.id=this.params.uid+dialogType;d.style.fontFamily="monospace";d.style.fontSize="13px";d.style.fontWeight="normal";d.style.textAlign="center";d.style.background="#fff";d.style.color="#000";d.style.padding="1.5em";d.style.width=sz.width+"px";d.style.height=sz.height+"px";d.style.margin="auto 0 auto 0";d.style.borderRadius="6px";d.style.zIndex=16777271;this.container.appendChild(d)}else{alert("error")}};WebVRPageDialogs.prototype.closeDialog_=function(){if(this.dom){this.container.removeChild(this.dom);this.dom=null}};WebVRPageDialogs.prototype.isOpenDialog=function(){return this.dom?true:false};WebVRPageDialogs.prototype.addButtons_=function(type){switch(type){default:break}};WebVRPageDialogs.prototype.addText_=function(){switch(type){default:break}};WebVRPageDialogs.prototype.adjustDialogSize_=function(width,height){if(this.container){if(!width){width=this.DEFAULT_WIDTH}if(!height){height=this.DEFAULT_HEIGHT}var w=Util.getElementWidth(this.container);var h=Util.getElementHeight(this.container);if(!w||!h){console.error("could not calculate dialog size");return}if(width>w){width=w}if(height>h){height=h}}return{width:width,height:height}};WebVRPageDialogs.prototype.centerCenter_=function(elem){var d=this.dom;var widthPercent=100*((this.container.style.width-d.style.width)/d.style.width);var heightPercent=(this.container.stye.height-d.style.height)/d.style.height;d.style.width=widthPercent+"%";d.style.height=heightPercent+"%";d.style.overflow="auto";d.style.margin="auto";d.style.position="absolute";d.top=d.left=d.bottom=d.right="0"};module.exports=WebVRPageDialogs},{"./emitter.js":6,"./modes.js":8,"./util.js":9,"./webvr-page-buttons.js":12}],14:[function(require,module,exports){var Emitter=require("./emitter.js");var Modes=require("./modes.js");var CardboardDistorter=require("./cardboard-distorter.js");var DeviceInfo=require("./device-info.js");var ViewerInfo=require("./viewer-info.js");var Util=require("./util.js");var WebVRPagePlayer=require("./webvr-page-player.js");function WebVRPageManager(renderer,effect,camera,params){this.params=params||{};this.prefix="webvr";this.uid=Util.getUniqueIncrementingId(this.prefix);params.prefix=this.prefix;params.uid=this.uid;this.mode=params.mode||Modes.ViewStates.DOM;this.renderer=renderer;this.effect=effect;this.camera=camera;this.isUndistorted=!!this.params.isUndistorted;this.player=new WebVRPagePlayer(renderer,params);this.deviceInfo=new DeviceInfo(params);this.viewerInfo=this.deviceInfo.viewerInfo;console.log("Using the %s viewer.",this.viewerInfo.getViewer().label);window.deviceInfo=this.deviceInfo;this.distorter=new CardboardDistorter(renderer,this.deviceInfo);this.stateButtons=this.player.getStatePanel();this.stateButtons.on(this.stateButtons.getButtonId(Modes.ButtonTypes.BUTTON_FULLSCREEN),this.requestFullscreen.bind(this));this.stateButtons.on(this.stateButtons.getButtonId(Modes.ButtonTypes.BUTTON_VR),this.requestVR.bind(this));this.backButtons=this.player.getBackPanel();this.backButtons.on(this.backButtons.getButtonId(Modes.ButtonTypes.BUTTON_BACK),this.exitFullscreen.bind(this));console.log("about to check for hmd");this.getDeviceByType_(HMDVRDevice).then(function(hmd){if(hmd){console.log("forcing distortion, hmd present:"+hmd.deviceName);this.distorter.setActive(true);this.hmd=hmd}else if(WebVRConfig.FORCE_DISTORTION){console.log("no hmd, forcing distortion due to WebVRConfig");this.distorter.setActive(true)}else{console.log("no hmd, no distortion forcing")}}.bind(this));this.getDeviceByType_(PositionSensorVRDevice).then(function(input){this.input=input}.bind(this));var size=this.player.getSize();this.resize(size.width,size.height);this.listenMotion_();this.listenResize_();this.listenFullscreen_();this.listenOrientation_();this.emit(this.prefix+"-initialized")}WebVRPageManager.prototype=new Emitter;WebVRPageManager.Modes=Modes;WebVRPageManager.Util=Util;WebVRPageManager.prototype.render=function(scene){if(this.mode==Modes.ViewStates.VR){this.distorter.preRender();this.effect.render(scene,this.camera);this.distorter.postRender()}else{if(scene instanceof Array){this.renderer.render(scene[0],this.camera)}else{this.renderer.render(scene,this.camera)}}};WebVRPageManager.prototype.getViewer=function(){return this.deviceInfo.getViewer()};WebVRPageManager.prototype.getDevice=function(){return this.deviceInfo.getDevice()};WebVRPageManager.prototype.getDeviceByType_=function(type){return new Promise(function(resolve,reject){navigator.getVRDevices().then(function(devices){for(var i=0;i<devices.length;i++){if(devices[i]instanceof type){resolve(devices[i]);break}}resolve(null)},function(){resolve(null)})})};WebVRPageManager.prototype.setHMDVRDeviceParams_=function(viewer){this.getDeviceByType_(HMDVRDevice).then(function(hmd){if(!hmd){console.error("in setHMDVRDeviceParams_, no hmd present");return}console.log("in setHMDVRDeviceParams, hmd present, setting HMDVRDeviceParams");if(hmd.setFieldOfView){hmd.setFieldOfView(this.deviceInfo.getFieldOfViewLeftEye(this.isUndistorted),this.deviceInfo.getFieldOfViewRightEye(this.isUndistorted))}if(hmd.setInterpupillaryDistance){hmd.setInterpupillaryDistance(viewer.interLensDistance)}if(hmd.setRenderRect){}}.bind(this))};WebVRPageManager.prototype.listenMotion_=function(){};WebVRPageManager.prototype.listenOrientation_=function(){window.addEventListener("orientationchange",this.onOrientationChange_.bind(this))};WebVRPageManager.prototype.listenFullscreen_=function(){document.addEventListener("fullscreenchange",this.onFullscreenChange_.bind(this));document.addEventListener("exitfullscreen",this.onExitFullscreen_.bind(this))};WebVRPageManager.prototype.listenResize_=function(){this.view=window;this.view.addEventListener("resize",function(e){this.onResize_(e)}.bind(this),false)};WebVRPageManager.prototype.onMotionChange_=function(e){console.log("devicemotion detected");var current=e.accelerationIncludingGravity,time,diff,deltaX=0,deltaY=0,deltaZ=0,dist};WebVRPageManager.prototype.onOrientationChange_=function(e){console.log("Manager orientation change event, object is:"+e)};WebVRPageManager.prototype.onResize_=function(e){console.log("resize event");var size=this.player.getSize();this.resize(size.width,size.height)};WebVRPageManager.prototype.resize=function(width,height){this.camera.aspect=width/height;this.camera.updateProjectionMatrix();this.renderer.setSize(width,height);this.effect.setSize(width,height)};WebVRPageManager.prototype.onFullscreenChange_=function(e){console.log("Manager onFullscreenChange_, target:"+e.target);console.log("Manager onFullscreenChange_, document.fullscreenElement is a:"+typeof document.fullscreenElement+" value:"+document.fullscreenElement);if(document.fullscreenElement===null){console.log("Manager, exitFullscreen event triggered, dispatching exitfullscreen event");document.exitFullscreen();var event=new CustomEvent("exitfullscreen");document.dispatchEvent(event)}else{}this.player.onFullscreenChange_(e)};WebVRPageManager.prototype.onExitFullscreen_=function(e){console.log("Manager onExitFullscreen_ custom event, object is:"+e);this.exitFullscreen()};WebVRPageManager.prototype.onErrorFullscreen_=function(e){console.log("Manager error on fullscreen change, object is:"+e)};WebVRPageManager.prototype.requestFullscreen=function(){if(this.params.detector.webgl){console.log("Manager entering fullscreen, mode:"+this.mode);if(this.mode==Modes.ViewStates.VR){this.exitVR()}console.log("WIDTH:"+screen.width+" HEIGHT:"+screen.height);this.effect.setSize(screen.width,screen.height);this.player.requestFullscreen(this.hmd)}};WebVRPageManager.prototype.exitFullscreen=function(){console.log("exiting exitFullscreen");if(this.mode==Modes.ViewStates.VR){this.exitVR()}this.player.exitFullscreen();document.exitFullscreen()};WebVRPageManager.prototype.requestVR=function(){this.requestFullscreen();this.setMode(Modes.ViewStates.VR);this.distorter.setActive(true);this.distorter.patch(this.camera)};WebVRPageManager.prototype.exitVR=function(){this.distorter.unpatch();this.setMode(Modes.ViewStates.DOM)};WebVRPageManager.prototype.setMode=function(mode){var oldMode=this.mode;if(mode==this.mode){console.error("Not changing modes, already in %s",mode);return}else if(mode==undefined){console.error("Not changing modes, in %s, mode is undefined",this.mode);return}console.log("Mode change: %s => %s",this.mode,mode);this.mode=mode;switch(mode){case Modes.ViewStates.DOM:break;case Modes.ViewStates.FULLSCREEN:break;case Modes.ViewStates.VR:this.setHMDVRDeviceParams_(this.getViewer());break;default:console.error("Unknown mode: %s => %s",this.mode,mode);break}this.emit(this.prefix+"-modechange",mode,oldMode)};module.exports=WebVRPageManager},{"./cardboard-distorter.js":1,"./device-info.js":2,"./emitter.js":6,"./modes.js":8,"./util.js":9,"./viewer-info.js":10,"./webvr-page-player.js":15}],15:[function(require,module,exports){var Emitter=require("./emitter.js");var Modes=require("./modes.js");var Util=require("./util.js");var WebVRPageDialogs=require("./webvr-page-dialogs.js");var WebVRPageButtons=require("./webvr-page-buttons.js");function WebVRPagePlayer(renderer,params,buttonTypes){this.playerClasses={player:"player",caption:"caption",canvas:"canvas"};this.dom=null;this.buttons=[];this.caption=null;this.params=params||{uid:Util.getUniqueIncrementingId()};this.uid=params.uid+"-"+this.playerClasses.player;this.captionDefault="WebVR Page Player Scene #"+parseInt(params.uid);this.canvasWarn="Your web browser does not support HTML5 canvas. You need to upgrade to a modern browser.";this.webglWarn="Your web browser cannot support 3D drawing necessary for VR. You need to upgrade to a modern browser";this.renderer=renderer;this.canvas=this.renderer.domElement;this.initFigure_();this.errorMsgIfNeeded_();this.initButtons_(buttonTypes);this.initCaption_();this.aspect=this.getCurrentWidth()/this.getCurrentHeight();this.ready=true}WebVRPagePlayer.prototype=new Emitter;WebVRPagePlayer.prototype.errorMsgIfNeeded_=function(){if(!this.params.canvas){}else if(!this.params.webgl){}};WebVRPagePlayer.prototype.getPlayerId=function(){return this.uid};WebVRPagePlayer.prototype.getContainer=function(){return this.dom};WebVRPagePlayer.prototype.getCanvas=function(){return this.canvas};WebVRPagePlayer.prototype.initFigure_=function(){var c=this.canvas;if(c.parentNode.tagName!="FIGURE"){this.dom=document.createElement("figure");c.parentNode.appendChild(this.dom);this.dom.appendChild(c)}else{this.dom=c.parentNode}var d=this.dom;var prefix=Util.parseText(this.params.uid);if(!d.id){d.id=this.getPlayerId()}Util.addClass(d,prefix+this.playerClasses.player);d.style.position="relative";if(!c.id){c.id=this.uid+this.playerClasses.canvas}Util.addClass(c,prefix+this.playerClasses.canvas);d.setAttribute("aria-describedby",this.uid+"-"+this.playerClasses.caption)};WebVRPagePlayer.prototype.initButtons_=function(buttonTypes){this.initStatePanel_();this.initBackPanel_()};WebVRPagePlayer.prototype.initStatePanel_=function(){this.statePanel=new WebVRPageButtons(Modes.PanelTypes.PANEL_STATE,Modes.PanelTypes.BOTTOM_RIGHT,this.dom,this.params);this.buttons[Modes.ButtonTypes.BUTTON_FULLSCREEN]=this.statePanel.createButton(Modes.ButtonTypes.BUTTON_FULLSCREEN,true);this.buttons[Modes.ButtonTypes.BUTTON_VR]=this.statePanel.createButton(Modes.ButtonTypes.BUTTON_VR,true)};WebVRPagePlayer.prototype.initBackPanel_=function(){this.backPanel=new WebVRPageButtons(Modes.PanelTypes.PANEL_BACK,Modes.PanelTypes.TOP_LEFT,this.dom,this.params);

this.backPanel.setPanelPosition(Modes.ButtonTypes.TOP_LEFT);this.buttons[Modes.ButtonTypes.BUTTON_BACK]=this.backPanel.createButton(Modes.ButtonTypes.BUTTON_BACK,true)};WebVRPagePlayer.prototype.getStatePanel=function(){return this.statePanel};WebVRPagePlayer.prototype.getBackPanel=function(){return this.backPanel};WebVRPagePlayer.prototype.initCaption_=function(){var figCaption=Util.getChildrenByTagName(this.dom,"figcaption");if(figCaption[0]){figCaption=figCaption[0]}else{figCaption=document.createElement("figcaption");this.dom.appendChild(figCaption)}figCaption.id=this.dom.getAttribute("aria-describedby");var prefix=Util.parseText(this.params.uid);Util.addClass(figCaption,prefix+this.playerClasses.player+"-"+this.playerClasses.caption);if(this.params.caption){figCaption.textContent=this.params.caption}else{if(figCaption.textContent==""){figCaption.textContent=this.captionDefault}}var s=figCaption.style;s.position="absolute";if(this.backPanel){s.marginBottom=this.backPanel.dom.style.height}else{s.marginBottom="24px"}s.width="100%";s.textAlign="center";this.caption=figCaption;this.setCaptionVisibility(true)};WebVRPagePlayer.prototype.getCaption=function(){return this.caption};WebVRPagePlayer.prototype.setCaptionVisibility=function(mode){if(mode){this.caption.style.visibility="block"}else{this.caption.style.visibility="none"}};WebVRPagePlayer.setCaptionLocation=function(loc){if(loc==Modes.ElementStates.TEXT_IN_DOM){}else if(loc==Modes.ElementStates.TEXT_IN_SPRITE){}};WebVRPagePlayer.prototype.onFullscreenChange_=function(){console.log("Player onFullscreenChange event")};WebVRPagePlayer.prototype.requestFullscreen=function(hmd){console.log("Player requestFullscreen");window.hh=hmd.fieldOfViewLeft;var cn=this.getContainer();var cs=this.getCanvas();Util.addClass(cn,Util.fullscreenClass);cn.requestFullscreen();return cn};WebVRPagePlayer.prototype.exitFullscreen=function(e){console.log("Player exitFullscreen");var cn=this.getContainer();var cs=this.getCanvas();Util.removeClass(cn,Util.fullscreenClass)};WebVRPagePlayer.prototype.getAspect=function(){return this.aspect};WebVRPagePlayer.prototype.getCurrentWidth=function(){return parseFloat(getComputedStyle(this.dom).getPropertyValue("width"))};WebVRPagePlayer.prototype.getCurrentHeight=function(){return parseFloat(getComputedStyle(this.dom).getPropertyValue("height"))};WebVRPagePlayer.prototype.getSize=function(){var h;if(document.fullscreenElement!==null){h=screen.height;w=screen.width}else{w=this.getCurrentWidth();h=this.getCurrentWidth()/this.aspect}return{width:w,height:h}};module.exports=WebVRPagePlayer},{"./emitter.js":6,"./modes.js":8,"./util.js":9,"./webvr-page-buttons.js":12,"./webvr-page-dialogs.js":13}]},{},[7]);