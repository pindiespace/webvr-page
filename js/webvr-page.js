(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){function Emitter(){this.callbacks={}}Emitter.prototype.emit=function(eventName){var callbacks=this.callbacks[eventName];if(!callbacks){return}var args=[].slice.call(arguments);args.shift();for(var i=0;i<callbacks.length;i++){callbacks[i].apply(this,args)}};Emitter.prototype.on=function(eventName,callback){if(eventName in this.callbacks){this.callbacks[eventName].push(callback)}else{this.callbacks[eventName]=[callback]}};module.exports=Emitter},{}],2:[function(require,module,exports){var WebVRPageManager=require("./webvr-page-manager.js");window.WebVRPageConfig=window.WebVRPageConfig||{};window.WebVRPageManager=WebVRPageManager},{"./webvr-page-manager.js":5}],3:[function(require,module,exports){var Modes={UNKNOWN:0,NORMAL:1,MAGIC_WINDOW:2,VR:3};module.exports=Modes},{}],4:[function(require,module,exports){var Util={};Util.getUniqueId=function(prefix){var i=Math.floor(Math.random()*999)+100;var pfx=prefix||"";function inc(pfx){if(!pfx){pfx=""}else{pfx+="-"}return pfx+i++}return inc}();Util.ua=function(complete){var ua={browser:{},os:{},device:{}};ua.name=(navigator.userAgent||navigator.vendor||window.opera).toLowerCase();ua.os.ios=/(iphone|ipad|ipod)/i.test(ua.name);ua.os.crios=/(cros|crmo)/i.test(ua.name);ua.os.mac=ua.name.indexOf("mac os x")>=0;ua.os.linux=ua.name.indexOf("linux")>=0;ua.os.windows=ua.name.indexOf("windows")>=0;ua.os.android=ua.name.indexOf("android")>=0;ua.os.blackberry=/(blackberry|bb10|rim[0-9])/i.test(ua.name);ua.os.firefoxOS=/mobile.*(firefox)/i.test(ua.name);ua.device.mobile=ua.os.ios||ua.os.android||/mobi|ip(hone|od|ad)|touch|blackberry|bb10|windows phone|kindle|silk|htc|(hpw|web)os|opera mini|fxios/i.test(ua.name);ua.device.tablet=/ipad|tablet|nexus[\s]+(7|9|10)|playbook|silk|ideapad|slate|touchpad|playbook|toshiba|xoom/i.test(ua.name);ua.device.console=/(nintendo|wiiu|3ds|playstation|xbox)/i.test(ua.name);ua.device.tv=/crkey|(google|apple|smart|hbb|opera).*tv|(lg|aquos|inettv).*browser|roku|espial/i.test(ua.name);ua.device.note4=ua.os.android&&ua.name.indexOf("samsung sm-n910c")>=0;ua.browser.ie=ua.name.indexOf("msie")>=0||ua.name.indexOf("trident")>=0;ua.browser.ie11=/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i.test(ua.name);ua.browser.edge=ua.name.indexOf("edge")>=0;ua.browser.safari=ua.name.indexOf("safari")>=0&&!ua.name.indexOf("chrome")>=0;ua.browser.chrome=ua.name.indexOf("chrome")>=0;ua.browser.amazon=ua.name.indexOf("silk")>=0;ua.browser.firefox=ua.name.indexOf("firefox")>=0;ua.browser.opera=ua.name.indexOf("opr/")>=0;return ua}();Util.fullscreenClass=function(fullscreenClass){var head=document.querySelector("head");var s=document.createElement("style");s.type="text/css";s.id="webvr-util-fullscreen-style";var rules="."+fullscreenClass+" {\n"+"	position: fixed !important;\n"+"	box-sizing: border-box !important;\n"+"	width: 100% !important;\n"+"	height: 100% !important;\n"+"	margin: 0 !important;\n"+"	left: 0 !important;\n"+"	top: 0 !important;\n"+" right:0 !important;\n"+" bottom:0 !important;\n"+"	z-index: 2147483647 !important;\n"+" background:black !important;\n"+"}\n";if(s.styleSheet){s.styleSheet.cssText=rules}else{var ruleNode=document.createTextNode(rules);s.appendChild(ruleNode)}head.appendChild(s);return fullscreenClass}("polyfill-full-screen");Util.isFullScreen=function(){if(document.fullscreenElement===null){return false}return true};Util.setFullscreen=function(){var hasStyles=false;var escHandler=function(e){console.log("in exitfullscreen keypress");if(e.keyCode==27){e.stopImmediatePropagation();document.exitFullscreen()}};if(!("fullscreenElement"in document)){Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement||null}})}if(!("fullscreenEnabled"in document)){Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.msFullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||function(){console.log("entering fullscreenEnabled polyfill function");var iframes=document.getElementsByTagName("iframe");window.ifs=iframes;for(var i=0;i<iframes.length;i++){console.log("trying iframe number:"+i);if(!iframes[i].allowfullscreen){console.log("found an iframe");return false}}return true}()}})}Element.prototype.requestFullscreen=Element.prototype.requestFullscreen||Element.prototype.webkitRequestFullscreen||Element.prototype.mozRequestFullScreen||Element.prototype.msRequestFullscreen||function(elem){console.log("in requestFullscreen polyfill fn");if(elem.nodeName==="IFRAME"&&!elem.allowfullscreen){document.fullscreenElement=null;return}if(document.fullscreenElement===null){document.fullscreenElement=this}document.addEventListener("keydown",escHandler,false);console.log("adding fullscreen class:"+Util.fullscreenClass);this.classList.add(Util.fullscreenClass);var event=new CustomEvent("fullscreenchange");event.target=this;if(typeof document.onfullscreenchange=="function"){console.log("dispatching from onfullscreenchange in requestFullscreen")}else{console.log("dispatching fullscreenchange in requestFullscreen");document.dispatchEvent(event)}};var screenChange=function(e){e.stopImmediatePropagation();if(e.type!=="fullscreenchange"){console.log("dispatching fullscreenchange in screenChange");var event=new CustomEvent("fullscreenchange",e);document.dispatchEvent(event)}};document.addEventListener("webkitfullscreenchange",screenChange);document.addEventListener("mozfullscreenchange",screenChange);document.addEventListener("MSFullscreenChange",screenChange);document.exitFullscreen=document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||function(){console.log("in exitfullscreen polyfill fn");if(document.fullscreenEnabled!=null){document.removeEventListener("keydown",escHandler,false);if(document.fullscreenElement){document.fullscreenElement.classList.remove(Util.fullscreenClass);document.fullscreenElement=null}}var event=new CustomEvent("fullscreenchange");if(typeof document.onfullscreenchange=="function"){document.onfullscreenchange(event)}else{document.dispatchEvent(event)}};var screenError=function(e){console.log("fullscreenError in screenError");e.stopImmediatePropagation();var event=new CustomEvent("fullscreenerror",e);document.dispatchEvent(event)};document.addEventListener("webkitfullscreenerror",screenError,false);document.addEventListener("mozfullscreenerror",screenError,false);document.addEventListener("MSFullscreenError",screenError,false);return function(){return document.fullscreenEnabled}}();module.exports=Util},{}],5:[function(require,module,exports){var Emitter=require("./emitter.js");var Modes=require("./modes.js");var Util=require("./util.js");var WebVRPagePlayer=require("./webvr-page-player.js");function WebVRPageManager(renderer,effect,camera,params){this.params=params||{};this.prefix="webvr";this.uid=Util.getUniqueId(this.prefix);this.renderer=renderer;this.effect=effect;this.camera=camera;this.player=new WebVRPagePlayer(renderer,params);this.getDeviceByType_(HMDVRDevice).then(function(hmd){this.hmd=hmd}.bind(this));this.getDeviceByType_(PositionSensorVRDevice).then(function(input){this.input=input}.bind(this));var size=this.player.getSize();this.resize(size.width,size.height);this.listenResize_();this.listenFullscreen_();this.listenOrientation_();this.emit("initialized")}WebVRPageManager.prototype=new Emitter;WebVRPageManager.Modes=Modes;WebVRPageManager.Util=Util;WebVRPageManager.prototype.render=function(scene){this.camera.updateProjectionMatrix();this.effect.render(scene,this.camera)};WebVRPageManager.prototype.getDeviceByType_=function(type){return new Promise(function(resolve,reject){navigator.getVRDevices().then(function(devices){for(var i=0;i<devices.length;i++){if(devices[i]instanceof type){resolve(devices[i]);break}}resolve(null)},function(){resolve(null)})})};WebVRPageManager.prototype.getDefaultDeviceFOV_=function(){return{downDegrees:40,leftDegrees:40,rightDegrees:40,upDegrees:40}};WebVRPageManager.prototype.cloneFOV_=function(fovObj){return{downDegrees:fovObj.downDegrees,upDegrees:fovObj.upDegrees,leftDegrees:fovObj.leftDegrees,rightDegrees:fovObj.rightDegrees}};WebVRPageManager.prototype.getFOV_=function(){var eyeFOVL,eyeFOVR;window.hhmd=this.hmd;if(this.hmd){var h=this.hmd;if(h.getEyeParameters!==undefined){var eyeParamsL=h.getEyeParameters("left");var eyeParamsR=h.getEyeParameters("right");eyeFOVL=this.cloneFOV_(eyeParamsL.recommendedFieldOfView);eyeFOVR=this.cloneFOV_(eyeParamsR.recommendedFieldOfView)}else if(h.getRecommendedFOV!==undefined){var eyeParamsL=h.getRecommendedFOV("left");var eyeParamsR=h.getREcommendedFOV("right");eyeFOVL=this.cloneFOV_(eyeParamsL);eyeFOVR=this.cloneFOV_(eyeParamsR)}else{eyeFOVL=this.cloneFOV_(h.getRecommendedEyeFieldOfView("left"));eyeFOVR=this.cloneFOV_(h.getRecommendedEyeFieldOfView("right"))}}else{eyeFOVL=this.getDefaultDeviceFOV_();eyeFOVR=this.getDefaultDeviceFOV_()}return{eyeFOVL:eyeFOVL,eyeFOVR:eyeFOVR}};WebVRPageManager.prototype.adjustFOV_=function(width,height){if(this.hmd){var aspectChange=height/width;console.log("going to adjust FOV, aspectChange:"+aspectChange);var fov=this.getFOV_();if(aspectChange>1){fov.eyeFOVL.upDegrees=fov.eyeFOVL.downDegrees=fov.eyeFOVR.upDegrees=fov.eyeFOVR.downDegrees*=aspectChange}this.effect.setFOV(fov.eyeFOVL,fov.eyeFOVR)}};WebVRPageManager.prototype.listenFullscreen_=function(){document.addEventListener("fullscreenchange",this.onFullscreenChange_.bind(this));document.addEventListener("exitfullscreen",this.onExitFullscreen_.bind(this))};WebVRPageManager.prototype.listenOrientation_=function(){window.addEventListener("orientationchange",this.onOrientationChange_.bind(this))};WebVRPageManager.prototype.listenResize_=function(){this.view=window;this.view.addEventListener("resize",function(e){this.onResize_(e)}.bind(this),false)};WebVRPageManager.prototype.onResize_=function(e){console.log("resize event");var size=this.player.getSize();this.resize(size.width,size.height)};WebVRPageManager.prototype.resize=function(width,height){this.camera.aspect=width/height;this.camera.updateProjectionMatrix();this.renderer.setSize(width,height);this.effect.setSize(width,height)};WebVRPageManager.prototype.onOrientationChange_=function(e){console.log("orientation change event, object is:"+e)};WebVRPageManager.prototype.onFullscreenChange_=function(e){console.log("fullscreen change");if(document.fullscreenElement===null){console.log("was fullscreen, dispatching exitfullscreen event, object is:"+e);var event=new CustomEvent("exitfullscreen");document.dispatchEvent(event)}this.player.onFullscreenChange_(e)};WebVRPageManager.prototype.onExitFullscreen_=function(e){console.log("onExitFullscreen_ custom event, object is:"+e);console.log("ABOUT TO RESET FOV");var fov=this.getFOV_();window.fov=fov;this.effect.setFOV(fov.eyeFOVL,fov.eyeFOVR);this.exitFullscreen()};WebVRPageManager.prototype.onErrorFullscreen_=function(e){console.log("error on fullscreen change, object is:"+e)};WebVRPageManager.prototype.requestFullscreen=function(){console.log("USER entering fullscreen");this.adjustFOV_(screen.width,screen.height);var canvas=this.player.requestFullscreen();canvas.requestFullscreen({vrDisplay:this.hmd})};WebVRPageManager.prototype.exitFullscreen=function(){console.log("exiting exitFullscreen");this.player.exitFullscreen();document.exitFullscreen()};module.exports=WebVRPageManager},{"./emitter.js":1,"./modes.js":3,"./util.js":4,"./webvr-page-player.js":6}],6:[function(require,module,exports){var Emitter=require("./emitter.js");var Modes=require("./modes.js");var Util=require("./util.js");function WebVRPagePlayer(renderer,params){this.params=params||{};this.renderer=renderer;this.canvas=this.renderer.domElement;this.dom=this.canvas.parentNode;this.aspect=this.getCurrentWidth()/this.getCurrentHeight()}WebVRPagePlayer.prototype=new Emitter;WebVRPagePlayer.prototype.onFullscreenChange_=function(){console.log("Player onFullscreenChange event")};WebVRPagePlayer.prototype.requestFullscreen=function(e){console.log("Player requestFullscreen");var cn=this.getContainer();var cs=this.getCanvas();cn.classList.add(Util.fullscreenClass);return cn};WebVRPagePlayer.prototype.exitFullscreen=function(e){console.log("Player exitFullscreen");var cn=this.getContainer();var cs=this.getCanvas();cn.classList.remove(Util.fullscreenClass)};WebVRPagePlayer.prototype.getContainer=function(){return this.dom};WebVRPagePlayer.prototype.getCanvas=function(){return this.canvas};WebVRPagePlayer.prototype.getAspect=function(){return this.aspect};WebVRPagePlayer.prototype.getCurrentWidth=function(){return parseFloat(getComputedStyle(this.dom).getPropertyValue("width"))};WebVRPagePlayer.prototype.getCurrentHeight=function(){return parseFloat(getComputedStyle(this.dom).getPropertyValue("height"))};WebVRPagePlayer.prototype.getSize=function(){var h;if(document.fullscreenElement!==null){h=this.getCurrentHeight()}else{h=this.getCurrentWidth()/this.aspect}return{width:this.getCurrentWidth(),height:h}};module.exports=WebVRPagePlayer},{"./emitter.js":1,"./modes.js":3,"./util.js":4}]},{},[2]);